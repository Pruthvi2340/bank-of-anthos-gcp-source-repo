###############
# Sonal cloud #
###############
# 1. sonar.host.url=https://sonarcloud.io
# 2. sonar.organization=pruthvi-gcp-devops
# 3. sonar.pojectkey=bank-of-anthos
# 4. sonar.login=04d9bd592f25db1d991090c621540fbed3541f6f

steps:
  # Execute Sonal cloud source on balancereader service
  - name: 'gcr.io/cloud-builders/mvn'
    id: balancereader-code-scanning
    entrypoint: mvn
    args: ['verify', 'sonar:sonar',
     '-Dsonar.host.url=https://sonarcloud.io','-Dsonar.organization=pruthvi-gcp-devops',
     '-Dsonar.porjectkey=bank-of-anthos', '-Dsonar.login=${_SONAR_TOKEN}']
    dir: src/ledger/balancereader
  # Execute Sonal cloud source on ledgerwriter service
  - name: 'gcr.io/cloud-builders/mvn'
    id: ledgerwriter-code-scanning
    entrypoint: mvn
    args: ['verify', 'sonar:sonar',
     '-Dsonar.host.url=https://sonarcloud.io','-Dsonar.organization=pruthvi-gcp-devops',
     '-Dsonar.porjectkey=bank-of-anthos', '-Dsonar.login=${_SONAR_TOKEN}']
    dir: src/ledger/ledgerwriter
  # Execute Sonal cloud source on accounts contacts service
  - name: 'gcr.io/cloud-builders/python3.10'
    id: contacts-code-scanning
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        pip install -r src/accounts/contacts/requirements.txt
        sonar-scanner \
          -Dsonar.host.url=https://sonarcloud.io \
          -Dsonar.organization=pruthvi-gcp-devops \
          -Dsonar.projectKey=bank-of-anthos \
          -Dsonar.login=${_SONAR_TOKEN}
    dir: src/accounts/contacts
  #Execute Sonal cloud source on accounts userservice service
  - name: 'gcr.io/cloud-builders/python3.10'
    id: userservice-code-scanning
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        pip install -r src/accounts/userservice/requirements.txt
        sonar-scanner \
          -Dsonar.host.url=https://sonarcloud.io \
          -Dsonar.organization=pruthvi-gcp-devops \
          -Dsonar.projectKey=bank-of-anthos \
          -Dsonar.login=${_SONAR_TOKEN}
    dir: src/accounts/userservice
substitutions:
  _SONAR_TOKEN: 04d9bd592f25db1d991090c621540fbed3541f6f
options:
  logging: CLOUD_LOGGING_ONLY