  steps:
  # Execute Sonar cloud source on accounts contacts service
  - name: ubuntu
    id: contacts-code-scanning
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        apt-get update
        apt-get -y install maven
        SNYK_TOKEN=${_SNYK_TOKEN}
        export SNYK_TOKEN
        mvn snyk:test -fn

        pip install -r requirements.txt
        wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-5.0.0.2966-linux.zip
        unzip sonar-scanner-cli-5.0.0.2966-linux.zip
        mv sonar-scanner-5.0.0.2966-linux /var/opt
        export sonar=/var/opt/sonar-scanner-5.0.0.2966-linux/bin
        export PATH=$sonar:$PATH
        sonar-scanner \
          -Dsonar.host.url=https://sonarcloud.io \
          -Dsonar.organization=pruthvi-gcp-devops \
          -Dsonar.projectKey=contacts \
          -Dsonar.login=${_SONAR_TOKEN}
    dir: src/accounts/contacts
  #Execute Sonar cloud source on accounts userservice service
  - name: ubuntu
    id: userservice-code-scanning
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        pip install -r requirements.txt
        wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-5.0.0.2966-linux.zip
        unzip sonar-scanner-cli-5.0.0.2966-linux.zip
        mv sonar-scanner-5.0.0.2966-linux /var/opt
        export sonar=/var/opt/sonar-scanner-5.0.0.2966-linux/bin
        export PATH=$sonar:$PATH
        sonar-scanner \
          -Dsonar.host.url=https://sonarcloud.io \
          -Dsonar.organization=pruthvi-gcp-devops \
          -Dsonar.projectKey=userservice \
          -Dsonar.login=${_SONAR_TOKEN}
    dir: src/accounts/userservice